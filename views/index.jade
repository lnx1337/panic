extends layout
block content

  div(id="map")
  div(id="mapdos")
  script
      var map = L.mapbox.map('map', 'lnx1337.map-eu8sxqx2');
      
      function addMarker(json){
          var f=json;
          var tam =f.length;
          var i=0;
          var geoJson=new Array();

          for(i=0;i<tam;i++){
            geoJson[i]={type: 'Feature',"geometry": { "type": "Point", "coordinates": [f[i].longitude,f[i].latitude]},"properties": {  "abonado_id":f[i].abonado_id,"description":f[i].mediaDescription ,"image": "/uploads/"+f[i].name+".png" ,"url": "http://en.wikipedia.org/wiki/Washington,_D.C.","marker-symbol": "star","city": f[i].descriptionAlert }}; 
          }

          map.markerLayer.on('layeradd', function(e) {
                  var marker = e.layer,
                      feature = marker.feature;
                      
                  var popupContent =  '<h1>'+feature.properties.description+'</h1><a target="_blank" class="popup" href="' + feature.properties.url + '">' +
                                          '<img src="' + feature.properties.image + '">' +
                                      '   <h2>' + feature.properties.city + '</h2>' +
                                      '</a>';
                  marker.bindPopup(popupContent,{
                      closeButton: false,
                      minWidth: 120
                  });
          });

          map.markerLayer.setGeoJSON(geoJson);
           

        }
        
       addMarker(!{JSON.stringify(data)});
       map.setView([19.43267,-99.133269], 5);
       map.markerLayer.on('click', function(e) {
           map.panTo(e.layer.getLatLng());
           $.ajax({
                          type: "GET",
                          url: "/abonado/"+e.layer.feature.properties['abonado_id'],
                          data: "",
                          success: function(datos){
                          alert(datos);  
                            // $("#content").html("<img src=\"/uploads/"+datos[0].name+".png\"  width=\"100\" height=\"100\"><br><br>Nombre:"+ datos[0].name+" "+datos[0].FirstName+"<br><hr width=\"100%\"/>Medio:"+datos[0].mediaDescription+"<br><hr width=\"100%\"/>Tipo Alerta: "+datos[0].descriptionAlert+"<br><hr width=\"100%\"/>Coordenadas: lat:"+datos[0].latitude+" lng:"+datos[0].longitude+"<br><hr width=\"100%\"/>Dispositivo:Iphone 5"+"<br><hr width=\"100%\"/>Carrier:"+"Telcel");
    
                          }
                  }); 
       });

  script
       var map = L.mapbox.map('mapdos', 'lnx1337.map-eu8sxqx2');
       map.setView([19.43267,-99.133269], 5);
                      
      
  div(id="content",class="element information")


          


    
   
   
